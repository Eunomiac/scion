$isShowingTestBG: false;

@mixin bubble($bubbleSize: 6, $bubbleHeight: 24px, $bubbleMargin: 4px) {
   $sizeRatio: $bubbleHeight / 100px; // Raw Image Height = 100px.
   $paddingLookup: (
      2: 12px,
      3: 12px,
      4: 14px,
      5: 14px,
      6: 16px,
      8: 16px,
      10: 16px
   );
   $indentLookup: (
      2: 112px,
      3: 212px,
      4: 292px,
      5: 392px,
      6: 446px,
      8: 646px,
      10: 846px
   );

   $bubbleWidth: $bubbleSize * (100px * $sizeRatio);
   $vertPad: 12px * $sizeRatio;
   $horizPad: map-get($paddingLookup, $bubbleSize) * $sizeRatio;
   $vertMarginTitle: $bubbleHeight * 0.05;

   $innerHeight: $bubbleHeight - (2 * $vertPad);
   $innerWidth: $bubbleWidth - (2 * $horizPad);

   $middleWidth: map-get($indentLookup, $bubbleSize) * $sizeRatio;
   $topIndent: ($innerWidth - $middleWidth) / 2;
   $bgImage: url("../images/bubbles/Bubble1x#{$bubbleSize}.png");
   
   @if ($isShowingTestBG) {
      $bgImage: url("../images/bubbles/TestBubble1x#{$bubbleSize}.png");
   }

   height: $innerHeight;
   width: $innerWidth;
   padding: $vertPad $horizPad;
   margin: $bubbleMargin;

   background: {
      image: $bgImage;
      size: 100% 100%;
      repeat: no-repeat;
      origin: border-box;
   }
   text-align: center;
   box-sizing: content-box;
   filter: drop-shadow(3px 3px 1px rgba(0, 0, 0, 0.5)); 
    
   .bubbleWrap::before {
      content: "";
      width: $topIndent;
      height: $innerHeight;
      float: left;
      shape-outside: polygon(
         0% 100%,
         0% 0%,
         100% 0%,
         0% 50%,
         100% 100%
         );
   }    
     
     &::before {
       content: "";
       width: $topIndent;
       height: $innerHeight;
       float: right;
       shape-outside: polygon(100% 100%, 100% 0%, 0% 0%, 100% 50%, 0% 100%);
     }
    
    span, p {
       display: block;
       text: {
          align: center;
          align-last: center;
       }
       @if ($isShowingTestBG) {
          background: rgba(0, 255, 255, 0.5);
          box-shadow: inset 0 0 1px purple, inset 0 0 1px purple, inset 0 0 1px purple;
       }
    }
    .bubbleTitle {
       display: block;
       grid-area: title;
       @if ($isShowingTestBG) {
          background: rgba(255, 145, 0, 0.5);
          box-shadow: inset 0 0 1px green, inset 0 0 1px green, inset 0 0 1px green;
       }
       text: {
          align: center;
          align-last: center;
       }
    }
 }


.bubble {
         
   p {margin: 0;}

   &.condition { 
      @include bubble(3, 75px, 4px);
      justify-content: start;
      margin: 4px 0;
      .bubbleWrap {
         height: 100%;

         .bubbleTitle {
            height: 25%;
            margin: 0;
            padding: 0;
            flex: 0 0 auto;
            color: black;
            font: {
               family: "Oswald";
               size: 12px;
               weight: normal;
            }
            line-height: 14px;
            text: {
               transform: uppercase;
            }
         }
         .bubbleBody { 
            height: 75%;
            margin: 0;
            padding: 0;
            flex: 0 0 auto;
            color: black;
            font: {
               family: "Overlock SC";
               size: 10px;
               weight: normal;
            }
            line-height: 10px;
         }
      }
   }

   &.connection {
      &.group, &.access { @include bubble(5, 40px); }         
      &.contact { @include bubble(6, 40px); }
   }
}

[class|="purview"] {
   display: inline-block;
   height: 100px;
   width: 80px;
   background: {
       size: 100%;
       repeat: no-repeat;
       position: center;
   };
   filter: hue-rotate(var(--colorPurviewRotate));
   &[class*="sun"] { background-image: url("../images/purviews/sun.png"); }
   &[class*="passion"] { background-image: url("../images/purviews/passion.png"); }
   &[class*="geasa"] { background-image: url("../images/purviews/geasa.png"); }
   &[class*="beauty"] { background-image: url("../images/purviews/beauty.png"); }
   &[class*="fortune"] { background-image: url("../images/purviews/fortune.png"); }

   span.text {
     display: block;
     margin-top: 110%;
     text-align: center;
     font-family: Oswald;
     text-transform: uppercase;
     margin-top: 95px;
     font-size: 12px;
 }
}